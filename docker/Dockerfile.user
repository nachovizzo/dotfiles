FROM ubuntu:22.04
LABEL maintainer="Ignacio Vizzo <ignaciovizzo@gmail.com>"

# install dependencies for polenta (host machine)
RUN apt-get update && apt-get install --no-install-recommends -y \
    ca-certificates \
    git \
    yadm \
    && rm -rf /var/lib/apt/lists/*

# FIXME: provide fix for theese root-need
RUN apt-get update && apt-get install --no-install-recommends -y \
    apt-rdepends \
    && rm -rf /var/lib/apt/lists/*

RUN apt-get update

# Add user to sahre files and folder without root permissions
ENV GROUP_ID=1000
ENV USER_ID=1000
RUN addgroup --gid $GROUP_ID user && adduser --disabled-password --gecos '' --uid $USER_ID --gid $GROUP_ID user
USER user

# Use --build-arg CACHEBUST=$(date +%s) to force this layer to re-run
ARG CACHEBUST=1

# Run all the magic, bootstrap included
RUN yadm clone https://github.com/nachovizzo/dotfiles.git
